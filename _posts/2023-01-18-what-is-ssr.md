---
layout: post
title: "[Web] SSR(서버 사이드 렌더링)와 CSR(클라이언트 사이드 렌더링)"
date: 2023-01-18 10:03:37 +0530
categories: Web
---

SSR(Server Side Rendering)와 CSR(Client Side Rendering), 이제는 이해해보자

# 웹의 역사 (SPA 시대까지)

---

- 1990년 중반까지는 모두 다 `Static Sites` 였다.

### Static Sites란?

서버에 잘 만들어진 html 문서들이 있고 사용자가 브라우저에서 주소로 접속하면 서버에 이미 배포된 HTML 문서를 받아와서 보여준다.

### Static Sites의 문제점은?

- Client: 페이지 내의 다른 링크를 클릭하면 서버에서 다시 해당 페이지의 HTML을 받아와서 **페이지 전체를 업데이트**해야 한다. Blinking Issue (페이지 깜빡임) -> 사용성이 매우 떨어진다.
- Server: 요청이 많아지면 서버 부하가 발생한다.

- 1996년, 문서 내에서 또 다른 문서를 담을 수 있는 `iframe` 태그가 도입되었다. 이제는 페이지 내에서 **부분적으로 문서를 받아와서 업데이트**할 수 있게 되었다.

- 1998년, 우리가 많이 쓰고 있는 fetch API의 원조 `XmlHttpRequest API`가 개발 되어 이제는 HTML 문서 전체가 아니라 **JSON**과 같은 포맷으로 서버에서 가볍게 필요한 데이터만 받아올 수 있게 되었다. 이 데이터를 **자바스크립트를 이용해 동적으로 HTML 요소를 생성**하여 페이지를 업데이트 한다.

- 2005년, 이런 방식이 공식적인 `AJAX`라는 이름을 갖게 되었다. 구글에서도 AJAX를 이용해서 Gmail, Google Maps과 같이 우리가 많이 쓰는 웹 어플리케이션을 만들기 시작한다. -> 이것이 현재 널리 쓰이고 있는 `SPA 싱글페이지 어플리케이션`이다.

### SPA(Single Page Application)란?

사용자가 한 페이지 내에 머무르면서 필요한 데이터를 서버에서 받아와 부분적으로 업데이트한다. -> 하나의 어플리케이션을 사용하듯 웹사이트에서도 사용성이 조금씩 좋아지게 된다.

url이 바뀌더라도 html을 다시 내리지 않는다.

- SPA 트렌드, 사용자들의 PC 성능이 점차 좋아짐에 따라 많은 것들을 무리 없이 처리할 수 있게 되었고 자바스크립트도 표준화가 되었다. 이에 강력한 커뮤니티를 바탕으로 Angular, React, Vue와 같은 프레임워크가 등장하며 `CSR 클라이언트 사이드 렌더링`의 시대로 접어들었다.

- React는 SPA를 만드는 것을 지원하는 라이브러리로, Client Side Rendering 방식으로 동작한다.

# CSR과 SSR

---

### CSR(Client Side Rendering)이란?

쉽게 말해 클라이언트에서 모든 걸 한다는 뜻이다.

<img width="508" alt="스크린샷 2023-01-19 오전 10 50 52" src="https://user-images.githubusercontent.com/68533016/213340958-192de629-a28d-484e-bd6d-ae1fbbd594bf.png">

html 구조를 보면 body 안에는 id root와 어플리케이션에서 필요한 자바스크립트의 링크(App.js)만 들어있다. 서버에서 index라는 HTML 파일을 클라이언트에 보내주면 HTML은 텅 비어있기 때문에 처음에 접속하면 빈 화면만 보인다. 다시 링크된 어플리케이션 자바스크립트**(App.js)를 서버로부터 다운로드 받게 되는데** App.js에는 어플리케이션에서 필요한 로직들 뿐만 아니라 어플리케이션을 구동하는 프레임워크와 라이브러리(React 등)의 소스코드들이 포함되어 있다. 따라서 **사이즈가 매우 커서 다운로드 받는 데 오랜 시간이 소요될 수 있다**.

추가로 필요한 데이터가 있다면 서버에서 받아온 다음에 이것들을 기반으로 동적으로 HTML을 생성해 사용자에게 최종적인 어플리케이션을 보여준다.

### CSR의 장점은?

- 웹을 앱과 비슷한 경험으로 사용할 수 있다.
  - url이 바뀌어도 html을 다시 내려 받지 않고 클라이언트에서 알아서 그린다.

### CSR의 문제점은?

- 사용자가 첫 화면을 보기까지 시간이 오래 걸릴 수 있다.
  - 서비스의 사이즈가 커질수록 코드가 많아지면 번들링된 하나의 자바스크립트 파일 bundle.js(react)의 크기가 커진다. 파일의 크기가 커지면 커질수록 파일을 로드하는 시간이 오래 걸린다. 로드하는 시간이 오래 걸린다는 것은 사용자가 첫 화면을 보기까지가 오래 걸린다는 말이다. _국내 서비스에서는 특히 이게 빨라야 한다고 한다 .. _
- 좋지 않은 SEO(Search Engine Optimization)

### SEO란?

Search Engine Optimization의 약자로, 검색 엔진들은 서버에 등록된 웹사이트를 하나씩 돌아다니며 웹사이트의 HTML 문서를 분석해 우리가 웹사이트를 빠르게 검색할 수 있게 도와준다.

하지만 CSR에서 사용된 HTML 바디는 대부분 텅 비어있기 때문에 검색 엔진들이 CSR로 작성된 웹페이지를 분석하는데 많은 어려움을 겪는다.

- CSR의 과도한 문제점 때문에 1990년 중반 쯤 사용했던 Static Sites에 대해 영감을 받은 `SSR 서버 사이드 렌더링`이 도입된다.

### SSR(Server Side Rendering)이란?

클라이언트에서 모든 것을 처리하는 방식과 다르게 웹사이트에 접속하면 서버에서 필요한 데이터를 보두 가져와서 HTML 파일을 만들고, 만들어진 HTML파일을 동적으로 제어할 수 있는 소스코드와 HTML을 함께 클라이언트에 보낸다. 이렇게 하면 바로 사용자에게 페이지를 보여줄 수 있다.

### SSR의 장점

- CSR을 사용했을 때보다 페이지 로딩이 빨라진다.
- 모든 컨텐츠가 HTML에 담겨져 있기 때문에 SEO가 효율적이다.

- 하지만 SSR이 모든 솔루션이 될 수 없다.

### SSR의 문제점

- Static Sties에서 발생했던 Blinking Issue가 존재한다.
  - 사용자가 클릭을 하게 되면 전체적인 웹사이트를 다시 서버에서 받아오는 것과 동일하기 때문에 좋지 않은 user experience를 겪을 수 있다.
- 서버 과부하가 걸리기 쉽다.
  - 사용자가 많은 제품일수록 사용자가 클릭을 할 때마다 서버에 요청해서 필요한 데이터를 가지고 와서 HTML을 만들어야 한다.
- (치명적인 단점) Need to wait before interaction
  - 사용자가 빠르게 웹사이트를 확인할 수 있지만, 동적으로 데이터를 처리하는 자바스크립트를 아직 다운로드 받지 못해서 클릭했는데 반응이 없는 경우가 발생할 수 있다. -> TTV vs TTI

### TTV(Time To View) vs TTI(Time To Interact)

#### CSR

<img width="1920" alt="스크린샷 2023-01-19 오전 11 11 57" src="https://user-images.githubusercontent.com/68533016/213340964-e7755bc3-531c-4f85-8e8a-d0e632c848fd.png"> 
출처 - [드림코딩](https://www.youtube.com/watch?v=iZ9csAfU5Os)

1. 사이트에 접속
2. 서버에게서 index 파일 받아옴 -> index 파일은 텅 비어있기 때문에 사용자에게 아무것도 보여주지 않음
3. HTMl 파일에 링크된 자바스크립트를 요청 (웹사이트에서 필요한 모든 로직이 담겨 있음)
4. 최종적으로 동적으로 HTML을 생성할 수 있는 웹 어플리케이션 로직이 담긴 자바스크립트 파일을 받아오게 됨 -> 이 순간부터 **viewable**, **interactable**

즉, CSR은 사용자가 웹사이트를 볼 수 있는 시간(TTV)과 클릭이나 인터렉션(TTI)이 가능한 시간이 **일치**한다.

#### SSR

<img width="1920" alt="스크린샷 2023-01-19 오전 11 18 40" src="https://user-images.githubusercontent.com/68533016/213340978-2f73ec95-af9d-4994-85d9-0f357f29b449.png">
출처 - [드림코딩](https://www.youtube.com/watch?v=iZ9csAfU5Os)

1. 사이트에 접속
2. 서버에서 이미 만든 index 파일을 받아옴 -> 이 순간부터 **viewable**, 하지만 아직 동적으로 제어할 수 있는 자바스크립트 파일은 받아오지 않았으므로 not interactive
3. 최종적으로 자바스크립트 파일을 서버에서 받아와야 함 -> 이 순간부터 **interactive**

즉, SSR은 사용자가 웹사이트를 볼 수 있는 시간(TTV)과 인터랙션 할 수 있는 시간(TTI)의 **공백 기간이 꽤 길다**.

### 성능 개선하기

웹사이트 성능 분석에 TTV와 TTI를 사용할 수 있다.

- CSR: 최종적으로 번들링해서 사용자에게 보내는 자바스크립트 파일을 효율적으로 분할해 첫 화면에 필수적인 부분만 보낼 수 있는 방법 고민해보기
- SSR: TTV와 TTI의 간격을 줄일 수 있는 방법 고민해보기

### SSG(Static Site Generation) - Gatsby

React는 CSR에 최적화된 라이브러리지만 Gatsby와 함께 사용한다면 React로 만든 웹 어플리케이션을 미리 정적으로 웹페이지를 생성해두고 서버에 배포해놓을 수 있다.

추가적으로 데이터를 받아오거나 동적으로 처리하는 로직도 추가할 수 있다.

### SSR(Server Side Rendering) - Next.js

- static sites도 지원하고 CSR과 SSR을 섞어 유연하게 사용할 수 있게 한다.

### 어느 것을 선택해야 할까?

- 만들고 있는 사이트는 정적인지, 동적인지
- 서버에서 동적으로 데이터를 얼마나 자주 받아오는지
- 얼마나 많은 사용자가 있는지

등을 고려해야 한다.

# **Reference**

- [드림코딩](https://www.youtube.com/watch?v=iZ9csAfU5Os)
- [개발화라리 Hwarang](https://www.youtube.com/watch?v=C6uELkDh-60)
